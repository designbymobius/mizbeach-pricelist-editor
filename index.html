<!DOCTYPE html>
<html manifest="manifest.appcache">	

	<head>
		<title>Mizbeach Price Updating App</title>
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/>

<style> /* -------------- */
/* DEFAULT RESETS */

html, body {

	margin: 0;
	padding: 0;
	width: 100%;
	overflow: hidden;
	font-family: arial, helvetica, sans-serif;
}

 /* --------------- */
/* GLOBAL CLASSES */

.fullscreen {

	position: relative;
	overflow: hidden;
	display: none;
	opacity: 0.4;

	padding: 3.0625em 1em;

	-webkit-transition: opacity 0.2s ease-in;
	-moz-transition: opacity 0.2s ease-in;
    -ms-transition: opacity 0.2s ease-in;
    -o-transition: opacity 0.2s ease-in;
	transition: opacity 0.2s ease-in;
}

.fullscreen.focal {

	opacity: 1;
}

.fullscreen.active {

	display: block;
}

.headline {

	font-weight: 900;	
	font-size: 1.75em;
	line-height: 0.925em;
	letter-spacing: -0.0625em;

	margin-bottom: 0.4em;
}

.title {

	font-size: 1.25em;
	line-height: 0.975em;
	letter-spacing: -0.05em;
}

.subtext {

	font-family: georgia, serif;
	margin-top: 0.8823529em;
	font-style: italic;
	font-size: 0.85em;
	color: #777;
	clear: both;
}

.btn {
	
	cursor: pointer;
	position: relative;
	text-align: center;
	text-transform: uppercase;
	
	color: #fff;
	background-color: #8ab953;

	border-bottom: .25em solid #3e7400;

	-webkit-border-radius: 0.416666666666em 0.416666666666em 0.416666666666em 0.416666666666em;
	border-radius: 0.416666666666em 0.416666666666em 0.416666666666em 0.416666666666em;
}

.btn:hover {

	top: .05em;
	border-bottom-width: .2em;
}

.btn:active {

	top: .15em;
	border-bottom-width: .1em; 
}

.btn.large {
	
	font-size: 1em;
	margin: 1.25em 0;
	font-weight: 900;

	line-height: 2.5em;
	word-spacing: 0.125em;
	letter-spacing: 0.0625em;

	text-shadow: 0.0625em 0.125em 0.0625em #3e7400;
	filter: dropshadow(color=#3e7400, offx=1, offy=2);
}

.btn.small {

	padding: .35em .7em;
	font-size: .75em;
	float: right;
}

.fullscreen input,
.fullscreen select.large {

	width: 97.5%;
	margin: 1em 1.25%;
	font-size: 1em;
	padding: .125em .5em;

	-webkit-box-sizing: border-box; /* Safari/Chrome, other WebKit */
	-moz-box-sizing: border-box;    /* Firefox, other Gecko */
	box-sizing: border-box;         /* Opera/IE 8+ */
}

 /* --------------- */
/* MODULE SPECIFIC */

/* Top-Level Controls */
	
	#app-hud {

		display: block;
		position: fixed;
		width: inherit;
		z-index: 10;
		top: 0;

		height: 3.5em;

		overflow: hidden;

		background: -moz-linear-gradient(top,  rgba(255,255,255,1) 0%, rgba(255,255,255,0.85) 60%, rgba(255,255,255,0) 100%); /* FF3.6+ */
		background: -webkit-gradient(linear, left top, left bottom, color-stop(0%,rgba(255,255,255,1)), color-stop(60%,rgba(255,255,255,0.85)), color-stop(100%,rgba(255,255,255,0))); /* Chrome,Safari4+ */
		background: -webkit-linear-gradient(top,  rgba(255,255,255,1) 0%,rgba(255,255,255,0.85) 60%,rgba(255,255,255,0) 100%); /* Chrome10+,Safari5.1+ */
		background: -o-linear-gradient(top,  rgba(255,255,255,1) 0%,rgba(255,255,255,0.85) 60%,rgba(255,255,255,0) 100%); /* Opera 11.10+ */
		background: -ms-linear-gradient(top,  rgba(255,255,255,1) 0%,rgba(255,255,255,0.85) 60%,rgba(255,255,255,0) 100%); /* IE10+ */
		background: linear-gradient(to bottom,  rgba(255,255,255,1) 0%,rgba(255,255,255,0.85) 60%,rgba(255,255,255,0) 100%); /* W3C */
		filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#ffffff', endColorstr='#00ffffff',GradientType=0 ); /* IE6-9 */
	}

	#app-hud .connection-indicator {

		float: left;
		display: block;
		position: relative;

	    border-radius: .375em;
		margin-top: 1.0625em;
		margin-left: 1em;
		height: .75em;
		width: .75em;
		  
	    background-color: orange;

	    -webkit-transition: background .35s ease-in;
		-moz-transition: background .35s ease-in;
		-ms-transition: background .35s ease-in;
		-o-transition: background .35s ease-in;
		transition: background .35s ease-in;
	}

	body.connection-online #app-hud .connection-indicator {

		background-color: green;
	}

	body.connection-offline #app-hud .connection-indicator {

		background-color: red;
	}

	body #app-hud .connection-indicator.connection-checking {

	    background-color: orange;
	}

	#app-hud .title {

		text-transform: uppercase;
		letter-spacing: 0;
		margin-left: .5em;
		line-height: 3em;
		font-weight: 900;
		font-size: 1em;
		float: left;
	}

	#app-hud .settings {

		display: block;
		position: relative;
		height: 18px;
		width: 18px;
		background-size: 100%;
		float: right;
		background-position: bottom;
		margin-right: 1em;
		margin-top: 15px;
		background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAABgCAYAAABbjPFwAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAADBhJREFUeNrEXAlQlNkR/gcUEBZcREAEAUUUQQUPUFBRYxHwKpVVs6urRtddN6UxYnS9YqWMRzTqmhJR3PWIJSLrfcSyPDYajqjgekYXl0MEgYiiCAgIyORrfEPG8Z/53//P/Juu6hqdef1e9zu6v+73VBDMJE9PT+vFixePKy4uzrh27dpaHhkvLy9h/fr108LDwzsJ/y8aMmSIz9atW+cXFhama7XaOrC2oaHh2ezZs4OlZBMTE2dR8/Ly8tzk5ORVY8aM6f6zKG1vb69ZtGjRiLS0tINQoEIrQq9fv77et29fe2N9LF++PAzNqg3EatPT0w8uWLBgmKurq3oGuLm5aZ4/f56llaDMzMyNrVq1ek9+8ODBLvX19fdNyZaUlFzG1uqqmhGY/RStNDWuXr16pL5chw4dNKWlpUc4ZLXjx4/vo6YB63mUqKmpycfedmdbTzh9+vQyHjlswaLQ0FAn1QyIj4//UstJL1++vJeRkZGUnZ29F3+t55F5+PBhauvWrbn1aSXXgDt37hTytnVycgqMiIgIlNN/ZWVldlNTE3d7K7kGvHnzphgfjWqtcGpq6o8YQz0DMEB+XV1dpVoGFBQU3JPTvsUAOzs7YdSoUZ4eHh72tra2xuKAsHHjxrn4Xa1D1oAtmqtIcvLkyQE4Q0+ePXuW/+jRo7PwGls2bdo0Z/78+UNCQkK8e/Xq5Xjq1Kl1WnlEAatKRvum/Pz8Xd7e3kZ3BsUXPz+/lrOr0f3h2LFjmydMmLDQiFxFY2NjOYT9JOahDAqcP3fu3CUEvOzHjx8/1Wg0WqxqexcXl65RUVFD/f39o9HOJAY6c+bM1qVLl67p37+/O1bds23btt6Q9WnTpo2Po6OjH6J1Vb9+/cai//pmgT59+lCEfKJVTk8RfZdNnTq1o4ODg1HF6Dco0j4lJeW3kCmSiAfl9GHsd2Cu6JaOt23b9hulmldUVFwEGu0mx3cTTZkyxROR+bDScW/cuJFsY2MjCB07drTDsv+gpJOysrIDAwYMsFN6YhFxNUVFRTuUjA3kW4Et5ins2bOHZv+N3A5evHhxEcrbmOt2wsLCrLASKUqMgO7zBXzmKZn8uLg4X0v5zkmTJrkg+srWA6t3TZgzZ84g7OPLcgSReX0lBpfNoYMHD36qZBWahYODgx2uXr2ayClTipjhYukIhlhjW1tbe1+O8sgdzrV00L59e+Ho0aNfSAWenJycXc2nXx2ovoZT97qzZ88uDwoKsn6vkxUrVgw0NRPbt2//RC0ctHbt2ijJTKmx8S5Sz0iTbhupnysgxU9i3gs5bV+1DIiOju5iagfcvn07cejQoc5cnV25ciVNzHvCdapWCgkICPAAlC57DyA1NVVh5T8Vi/Jy4bSWsSrU4lUMCPD9IXLspFevXvEZMHbsWHeArg5icGbEiBHOahng4+Nja2Vl9R6Wr6qq0rq5uUknNLREsDQGsDmd0KNIextCg2oZgPTTGx+OIuWcnkCo34WHhxsvGg0cONAe+54qDo2mvACS9C1qGQCUusTU2MiX7wJmh727BFZWwvTp00OwvzK4HHBdXS7gt72lle/du7cV+r7GoUJlcnLy59ghbwUREFbjy+dyIiDC/q8tbcC+fftiyOHIgNPbhw0b5khlDNlQGm4td+LEiR9acO/b1dTUZCmA88eElStXjtRVl+UQ0rm/9e1rfkyjQgEC1CYlQO7QoUNfC506dbLOzc1NU9IBkv91OA+KlSevd/LkycUKk7JXo0eP9tOllHOVpnZYiW8R3tsquF+wvXnz5nql4966desAkvy3nSHD74gk+qXSzpDe3dm/f38sVsNaSnFAd2HDhg3RGC9Dq5yapk2bNvidskpmZmYyctRPjMCHp7qYYkq5+vr6LOQVx9PT09MuXbpUiFSxmuSBHB1iYmI8cWYixo0bNwFwfIg55waZWHq3bt0i4Xa1LWlVUlLSLg8PDx8qb2dlZT3C1igAdC2EQkUFBQVlXl5eNnv37t3v6uoaaaxjKBYaGRlJTDcxFQBmzQZYW1sTCmvHo9yTJ09uAbgttLOzc+3cuXNP5MwB2CrdoZuXrg8EvARS/r2ARuVFU8kK4K43lq9cqxLB4KdYqXcgDJU5nZ2draOiojyweoMSEhI+9vX1dVC0dIAb/kpcrpwsEVujnRydZMHpMWPGBNCkqHiP6I6coKNqBmAvBgrqkpXchIm7NkJllOHDh/eQ0XcNuFw3s3TGeYQ0Go23KitAyRIOE++FdPWqVatGIy4Ew3UGb9myZRbvOPA8vjDC8msbEhLiDMBVynMSd+/e/Zm+LJIgAZGTqwaak5OTLLdQzEWxsbGhPApcv359h9htO+CGU3V19R0p+cLCwky4TssvQWBgoA9Q42FTbhS561VEc6PJzrx58yKk3HB2dvYFxCJrdVwEgh2S+iDkpxsxVrEhPAc+6S7lCKiiJlauSU1NTY6Lixvp7+9vJ/wchCTEdfPmzb9D6Kdt8TI+Pj6aRw5RtFVxcfEFuswHVrqCPhbSyxelemhOnDihpH4j1NbWCnQh3aNHjw/c3d2nIcXrAyhwCx5ku8lryIYGISgo6EMnJ6d5MGDPgwcPSmhlCRor8T6akpISpcb7wpBYINBfQfEQ4CgbKEK+n2DuTVOCAGIzYfw32FKl8DhJUHw/vv5R0Qrk5eXJag/+BXg2mF6jiCUyP4AjWSATvZQB/4MSMn2bwLQVdoIvq21AJri/RLtN4MUi31MtJA1sKqL/k00Q14W3ktooj8VxbIUMjd8poXxzyBCrzlnKAKICjjbkxxMYBtLRUvBHHLKPOSdJHpiTaUAzrGF7nQ50A3gqp9xDcKWaBhTKaBvIWA5lq5YPMFL1vZBcd6rEgHw5S6yA7pljgCdV+yRk5oJVey/E6z7FzkAA88F0j/OA7UXi++BH4BfgZYx56RVzvR/I0Gc5+Atwk0S7RkMDPtcrXJEHidH7rYKlh5LvhcDnwZeY8U+ZAe3BXZmPN/VeiGLFZ8zwNcwN066gNNOHMelQBR5LtTRdJHZhM+2mcOmfgb+mMj9YClyRMVQB/ArsZaLdc7ZyxnJpmuBzujMw2QzlvwcPAv+ZQ3mdsfFUZgIfMdGunUQhYIbuENsx7KGEkqlcBP5JoTumiUtUOPYo2l5kwEzK2RXO/EyGJJWSlnm17xTIEhL+iM4AHYIuMoWfMlhcYCH36cJQrlw9MmkFpjP3KYc2WVB5gXm4PyqQCyMDMsCjGdTlof+Ad6sQxA4ryMrOW+kFnC/Bc6iqJiF0Rq9kaEl6DT4mo+0KOsiGUOIbcJTETHyvIg7i2cr/Bv8SvA78RgzMXWURM0fkt0YGM9SiPIkdsJPl26lSaJS8zBOR76uF/92XqUG1jMXGnca2+Qtzc2KtigZoTWRpSXLyAQJRou+FwM4qGmAriN8AaeUkNASS0hl6NCQbDkRqDnkbqUj0ZNHa1ZQBlMisB//diPL6ZQ+1KELQu7s20HMyKxKEiRlAWOgCeAkriZiisRxZmxIiXWIl2tBKXGS5S4vQamZZBOdAfmw2LE3k20M52jmyeEVFZEcCc1TLlPtuhvx1f5apWYII0qcJ0iVLQzpOK/AHFprlEK3CXy04+2sUKE9UYMVy2CwFwjNYODeXqAj8ewVyVP1OIAPoX52lKBycKhTfCuJldh6fT17vLwrHpnJ8ns4LHTejWDWb7d9YDg+mo2jmOJaYEbF3NJcx9O4Hklm1QKwx13shthWPM4MKGYbRsgjuyTzdBPAQM7ddOgN1Wv260C5WdylihawCpkQRq/dQFN7PBI1RqJ4rrDAwgPcVyi3wQhZ1e7KCW3dWgtH1kaCDF3JvaCjU35ShjJL6UrjwfnnRmq1+F1YUO82SMNnldVvh3bstS1MDK2gZEjmaUsZcaNQYqf5eCKzeeyFB/mWFEjykznshRqq/F2LnTLUV4H4vxEo1wYxnyRjDVy0DnGV0vkB4e2H9gvEBgb8G6qOWAV2NpJmGlGik8EVR9y7nOBo1DKBgdkQCuV4zAcwqWVVBCvm+lKOXHAMoOk8C9wNvFN6Wxw0NnCEYfyNB9C/wn0S+r2BQZhTL+Lj/WwO5kVifKNR/LLy9EuoGnsIQIo/no7w7imGnFIafHilR4r8CDAD8Y+TOoiJw3QAAAABJRU5ErkJggg==);
	}

	#app-hud .settings:hover {

		background-position: top;
	}

	#context-settings {

		float: right;
		margin: 0 1em;
		font-size: 1em;
		line-height: 3em;
	}

	#context-settings .setting {

		color: #bbb;
		font-size: 75%;
		margin-left: 1em;
		font-weight: 900;

		float: right;
		cursor: pointer;
		text-transform: uppercase;

		transition: color .75s ease-out;
	}

	#context-settings .setting:hover {

		color: red;
	}

/* Task List */
	#task-list {

		list-style-type: none;
		float: left;

		font-size: 1.25em;
		margin-top: 1.5em;
		padding: 0;
	}

	#task-list li {

		padding: 0.5em 3.5em 0.5em 1.5em;
		border-bottom: 1px solid #ddd;
		font-weight: 900;
		color: #1087bc;

		cursor: pointer;
	}

	#task-list li:hover {

		background-color: #e0f3fc;
	}

	#task-list li:active {

		color: #0b5a7d;
	}

	#task-list a {

		text-decoration: none;
	}

/* Add Products */
	.add-product.focal input.attention,
	.add-product.focal select.attention {

		border-color: red;
		color: red;
	}

	.add-product #product-metadata {

		font-weight: 900;
		line-height: 2em;
		font-size: 2.25em;
		text-transform: uppercase;
	}

	.add-product select.manufacturer-list {

		margin-bottom: .5em;
	}

/* View Products */
	#product-list {

		width: 100%;
		font-size: 0.85em;
		overflow: auto;
	}

	#product-list .product {

		position: relative;
		border-bottom: 1px solid #ddd;
		text-transform: uppercase;
		padding: 1em;
		line-height: 1.25em;
	}

	#product-list .product.edit-product {

		background-color: orange;
	}

	#product-list .product.editted-product {

		background-color: #8f8;
	}

	#product-list .product > div {

		display: inline-block;
	}

	#product-list .product .collapsed-content {

		display: none;
	}

	#product-list .product .name {

		width: 42%;
	}

	#product-list .product .wholesale-price,
	#product-list .product .retail-price,
	#product-list .product .settings {

		width: 19%;
		text-align: right;
	}

	#product-list .product .settings {

		color: #aaa;
		font-size: 0.7em;
		letter-spacing: 0.3em;
	}

	#product-list .edit-product .collapsed-content {

		display: inline-block;
	}

	#product-list .edit-product .name {
		
		color: #fff;
		font-weight: 900;
		font-size: 144%;
		line-height: 1.2em;
	}

	#product-list .edit-product .settings {

		color: #fff;
	}

	#product-list .edit-product .settings .options {

		position: absolute;
		border: 8px solid #fff;
		background-color: #fff;
		color: #fff;
		padding: 0px;
		margin: .35em 0 0 -6.8em;
		font-size: .85em;
		list-style: none;
		text-align: center;

		z-index: 100;
	}

	#product-list .edit-product .settings .options li {
		
		background-color: #b84915;
		margin-bottom: .5em;
		padding: .5em .75em;
	}

	#product-list .edit-product .settings > span {

		background-color: #fff;
		padding: .7em .75em;
		color: red;
		font-weight: 900;
	}

	#product-list .edit-product .settings .options li:hover,
	#product-list .edit-product .settings .options li:active {

		background-color: #C46005;
	}

	#product-list .product .modified-value {

		font-weight: 900;
	}

	#product-list .manufacturer-filter-match {

		background-color: #ffa;
	}

	#product-list.filtered .product {

		display: none;
	}

	#product-list.filtered .manufacturer-filter-match {

		display: block;
	}

	#manufacturer-filter {

		float: right;
		padding: .25em .75em;
		background-color: #eee;
	}

	#manufacturer-filter label {

		text-transform: uppercase;
		color: #444;
		font-size: 0.7em;
		letter-spacing: 0.15em;
		padding-right: .5em;
	}

@media only screen and (min-width:500px)  { 

	.fullscreen {

		font-size: 108%;
		padding: 3em 2.5em;
	}
}

@media only screen and (min-width:625px)  { 

	.fullscreen {

		font-size: 127%;
	}
}

@media only screen and (min-width:900px)  { 

	.fullscreen {

		font-size: 133%;
		padding: 3.25em 5em;
	}
}

@media only screen and (min-width:1120px)  {

	#product-list .edit-product .settings .options {

		margin-left: 5.5em;
	}
} </style>
	</head>

	<body>

		<header id="app-hud">
			<div class="connection-indicator" title="Network Connection Status"></div>
			<div class="title"> Mizbeach </div>
			<div class="settings"></div>
			<div id="context-settings"></div>
		</header>

		<div id="landing" class="fullscreen landing">
			
			<div class="headline">Painless Price List Updates</div>
			<div class="title">A Quick Way to Update Wholesale / Retail Prices and Add New Products to the Price List</div>
			<div class="subtext">Really Simple: No more struggling with Excel!</div>
			<div id="start-app" class="btn large">Get Started</div>
		</div>

		<div id="view-product-list" class="fullscreen view-product">
		
			<div id="manufacturer-filter">
				<label>Manufacturer</label>
				<select id="manufacturer-list"></select>
			</div>
			<div id="product-list"></div>
		</div>

		<div id="add-product-metadata" class="fullscreen add-product">
			
			<div class="headline">New Product Details</div>
			<select class="manufacturer-list large"></select>
			<input class="manufacturer-name" type="hidden" placeholder="Manufacturer">
			<input class="product-name" placeholder="Product Name">
			<div class="btn small">Next Step</div>	
		</div>

		<div id="add-product-confirmation" class="fullscreen add-product">
			
			<div class="headline">Review Details</div>
			<div class="title">Are these details correct? </div>
			<div id="product-metadata">
				<span class="manufacturer-name"></span>
				<span class="product-name"></span>
			</div>
			<div id="submit-add-product" class="btn large">Yes - Add It</div>	
		</div>

<script type="text/javascript">/*! offline 0.4.7 */
(function(){var a,b,c,d,e,f,g;d=function(a,b){var c,d,e,f;f=[];for(d in b.prototype)try{e=b.prototype[d],null==a[d]&&"function"!=typeof e?f.push(a[d]=e):f.push(void 0)}catch(g){c=g}return f},a={},null==a.options&&(a.options={}),c={checks:{xhr:{url:function(){return"/offline-test-request/"+Math.floor(1e9*Math.random())}},image:{url:function(){return"http://dqakt69vkj09v.cloudfront.net/are-we-online.gif?_="+Math.floor(1e9*Math.random())}},active:"image"},checkOnLoad:!1,interceptRequests:!0,reconnect:!0},e=function(a,b){var c,d,e,f,g,h;for(c=a,f=b.split("."),d=g=0,h=f.length;h>g&&(e=f[d],c=c[e],"object"==typeof c);d=++g);return d===f.length-1?c:void 0},a.getOption=function(b){var d,f;return d=null!=(f=e(a.options,b))?f:e(c,b),"function"==typeof d?d():d},"function"==typeof window.addEventListener&&window.addEventListener("online",function(){return setTimeout(a.confirmUp,100)},!1),"function"==typeof window.addEventListener&&window.addEventListener("offline",function(){return a.confirmDown()},!1),a.state="up",a.markUp=function(){return a.trigger("confirmed-up"),"up"!==a.state?(a.state="up",a.trigger("up")):void 0},a.markDown=function(){return a.trigger("confirmed-down"),"down"!==a.state?(a.state="down",a.trigger("down")):void 0},f={},a.on=function(b,c,d){var e,g,h,i,j;if(g=b.split(" "),g.length>1){for(j=[],h=0,i=g.length;i>h;h++)e=g[h],j.push(a.on(e,c,d));return j}return null==f[b]&&(f[b]=[]),f[b].push([d,c])},a.off=function(a,b){var c,d,e,g,h;if(null!=f[a]){if(b){for(d=0,h=[];d<f[a].length;)g=f[a][d],c=g[0],e=g[1],e===b?h.push(f[a].splice(d,1)):h.push(d++);return h}return f[a]=[]}},a.trigger=function(a){var b,c,d,e,g,h,i;if(null!=f[a]){for(g=f[a],i=[],d=0,e=g.length;e>d;d++)h=g[d],b=h[0],c=h[1],i.push(c.call(b));return i}},b=function(a,b,c){var d,e;return d=function(){return a.status&&a.status<12e3?b():c()},null===a.onprogress?(a.addEventListener("error",c,!1),a.addEventListener("timeout",c,!1),a.addEventListener("load",d,!1)):(e=a.onreadystatechange,a.onreadystatechange=function(){return 4===a.readyState?d():0===a.readyState&&c(),"function"==typeof e?e.apply(null,arguments):void 0})},a.checks={},a.checks.xhr=function(){var c,d;d=new XMLHttpRequest,d.offline=!1,d.open("HEAD",a.getOption("checks.xhr.url"),!0),b(d,a.markUp,a.markDown);try{d.send()}catch(e){c=e,a.markDown()}return d},a.checks.image=function(){var b;return b=document.createElement("img"),b.onerror=a.markDown,b.onload=a.markUp,b.src=a.getOption("checks.image.url"),void 0},a.check=function(){return a.trigger("checking"),a.checks[a.getOption("checks.active")]()},a.confirmUp=a.confirmDown=a.check,a.onXHR=function(a){var b,c,e;return b=function(b,c){var d;return d=b.open,b.open=function(e,f,g,h,i){return a({type:e,url:f,async:g,flags:c,user:h,password:i,xhr:b}),d.apply(b,arguments)}},e=window.XMLHttpRequest,window.XMLHttpRequest=function(a){var c,d,f;return c=new e(a),b(c,a),f=c.setRequestHeader,c.headers={},c.setRequestHeader=function(a,b){return c.headers[a]=b,f.call(c,a,b)},d=c.overrideMimeType,c.overrideMimeType=function(a){return c.mimeType=a,d.call(c,a)},c},d(window.XMLHttpRequest,e),null!=window.XDomainRequest?(c=window.XDomainRequest,window.XDomainRequest=function(){var a;return a=new c,b(a),a},d(window.XDomainRequest,c)):void 0},g=function(){return a.getOption("interceptRequests")&&a.onXHR(function(c){var d;return d=c.xhr,d.offline!==!1?b(d,a.confirmUp,a.confirmDown):void 0}),a.getOption("checkOnLoad")?a.check():void 0},setTimeout(g,0),window.Offline=a}).call(this),function(){var a,b,c,d,e,f,g,h,i;if(!window.Offline)throw new Error("Offline Reconnect brought in without offline.js");d=Offline.reconnect={},f=null,e=function(){var a;return null!=d.state&&"inactive"!==d.state&&Offline.trigger("reconnect:stopped"),d.state="inactive",d.remaining=d.delay=null!=(a=Offline.getOption("reconnect.initialDelay"))?a:3},b=function(){var a,b;return a=null!=(b=Offline.getOption("reconnect.delay"))?b:Math.min(Math.ceil(1.5*d.delay),3600),d.remaining=d.delay=a},g=function(){return"connecting"!==d.state?(d.remaining-=1,Offline.trigger("reconnect:tick"),0===d.remaining?h():void 0):void 0},h=function(){return"waiting"===d.state?(Offline.trigger("reconnect:connecting"),d.state="connecting",Offline.check()):void 0},a=function(){return Offline.getOption("reconnect")?(e(),d.state="waiting",Offline.trigger("reconnect:started"),f=setInterval(g,1e3)):void 0},i=function(){return null!=f&&clearInterval(f),e()},c=function(){return Offline.getOption("reconnect")?"connecting"===d.state?(Offline.trigger("reconnect:failure"),d.state="waiting",b()):void 0:void 0},d.tryNow=h,e(),Offline.on("down",a),Offline.on("confirmed-down",c),Offline.on("up",i)}.call(this),function(){var a,b,c,d,e,f;if(!window.Offline)throw new Error("Requests module brought in without offline.js");c=[],f=!1,d=function(a){return Offline.trigger("requests:capture"),"down"!==Offline.state&&(f=!0),c.push(a)},e=function(a){var b,c,d,e,f,g,h,i,j;i=a.xhr,f=a.url,e=a.type,g=a.user,d=a.password,b=a.body,i.abort(),i.open(e,f,!0,g,d),j=i.headers;for(c in j)h=j[c],i.setRequestHeader(c,h);return i.mimeType&&i.overrideMimeType(i.mimeType),i.send(b)},a=function(){return c=[]},b=function(){var b,d,f,g,h,i;for(Offline.trigger("requests:flush"),f={},h=0,i=c.length;i>h;h++)d=c[h],g=d.url.replace(/(\?|&)_=[0-9]+/,function(a,b){return"?"===b?b:""}),f[""+d.type.toUpperCase()+" - "+g]=d;for(b in f)d=f[b],e(d);return a()},setTimeout(function(){return Offline.getOption("requests")!==!1?(Offline.on("confirmed-up",function(){return f?(f=!1,a()):void 0}),Offline.on("up",b),Offline.on("down",function(){return f=!1}),Offline.onXHR(function(a){var b,c,e,f,g;return e=a.xhr,b=a.async,e.offline!==!1&&(c=function(){return d(a)},g=e.send,e.send=function(b){return a.body=b,g.apply(e,arguments)},b)?null===e.onprogress?(e.addEventListener("error",c,!1),e.addEventListener("timeout",c,!1)):(f=e.onreadystatechange,e.onreadystatechange=function(){return 0===e.readyState?c():4===e.readyState&&(0===e.status||e.status>=12e3)&&c(),"function"==typeof f?f.apply(null,arguments):void 0}):void 0}),Offline.requests={flush:b,clear:a}):void 0},0)}.call(this),function(){var a,b,c,d,e,f,g,h,i,j,k,l,m;if(!window.Offline)throw new Error("Offline UI brought in without offline.js");b='<div class="offline-ui"><div class="offline-ui-content"></div></div>',a='<a href class="offline-ui-retry"></a>',e=function(a){var b;return b=document.createElement("div"),b.innerHTML=a,b.children[0]},f=d=null,c=function(a){return k(a),f.className+=" "+a},k=function(a){return f.className=f.className.replace(new RegExp("(^| )"+a.split(" ").join("|")+"( |$)","gi")," ")},h={},g=function(a,b){return c(a),null!=h[a]&&clearTimeout(h[a]),h[a]=setTimeout(function(){return k(a),delete h[a]},1e3*b)},i=function(a,b){var c,d,e,f,g,h;if(null==b&&(b=!1),0===a)return"now";c={d:86400,h:3600,m:60,s:1},d={s:"second",m:"minute",h:"hour",d:"day"},f="";for(g in c)if(e=c[g],a>=e)return h=Math.floor(a/e),b&&(g=" "+d[g],1!==h&&(g+="s")),""+h+g},l=function(){var g,h;return f=e(b),document.body.appendChild(f),null!=Offline.reconnect&&Offline.getOption("reconnect")&&(f.appendChild(e(a)),g=f.querySelector(".offline-ui-retry"),h=function(a){return a.preventDefault(),Offline.reconnect.tryNow()},null!=g.addEventListener?g.addEventListener("click",h,!1):g.attachEvent("click",h)),c("offline-ui-"+Offline.state),d=f.querySelector(".offline-ui-content")},j=function(){return l(),Offline.on("up",function(){return k("offline-ui-down"),c("offline-ui-up"),g("offline-ui-up-2s",2),g("offline-ui-up-5s",5)}),Offline.on("down",function(){return k("offline-ui-up"),c("offline-ui-down"),g("offline-ui-down-2s",2),g("offline-ui-down-5s",5)}),Offline.on("reconnect:connecting",function(){return c("offline-ui-connecting"),k("offline-ui-waiting")}),Offline.on("reconnect:tick",function(){return c("offline-ui-waiting"),k("offline-ui-connecting"),d.setAttribute("data-retry-in-seconds",Offline.reconnect.remaining),d.setAttribute("data-retry-in-abbr",i(Offline.reconnect.remaining)),d.setAttribute("data-retry-in",i(Offline.reconnect.remaining,!0))}),Offline.on("reconnect:stopped",function(){return k("offline-ui-connecting offline-ui-waiting"),d.setAttribute("data-retry-in-seconds",null),d.setAttribute("data-retry-in-abbr",null),d.setAttribute("data-retry-in",null)}),Offline.on("reconnect:failure",function(){return g("offline-ui-reconnect-failed-2s",2),g("offline-ui-reconnect-failed-5s",5)}),Offline.on("reconnect:success",function(){return g("offline-ui-reconnect-succeeded-2s",2),g("offline-ui-reconnect-succeeded-5s",5)})},"complete"===document.readyState?j():null!=document.addEventListener?document.addEventListener("DOMContentLoaded",j,!1):(m=document.onreadystatechange,document.onreadystatechange=function(){return"complete"===document.readyState&&j(),"function"==typeof m?m.apply(null,arguments):void 0})}.call(this);

Persist=(function(){var VERSION='0.1.0',P,B,esc,init,empty,ec;ec=(function(){var EPOCH='Thu, 01-Jan-1970 00:00:01 GMT',RATIO=1000*60*60*24,KEYS=['expires','path','domain'],esc=escape,un=unescape,doc=document,me;var get_now=function(){var r=new Date();r.setTime(r.getTime());return r;}
var cookify=function(c_key,c_val){var i,key,val,r=[],opt=(arguments.length>2)?arguments[2]:{};r.push(esc(c_key)+'='+esc(c_val));for(i=0;i<KEYS.length;i++){key=KEYS[i];if(val=opt[key])
r.push(key+'='+val);}
if(opt.secure)
r.push('secure');return r.join('; ');}
var alive=function(){var k='__EC_TEST__',v=new Date();v=v.toGMTString();this.set(k,v);this.enabled=(this.remove(k)==v);return this.enabled;}
me={set:function(key,val){var opt=(arguments.length>2)?arguments[2]:{},now=get_now(),expire_at,cfg={};if(opt.expires){opt.expires*=RATIO;cfg.expires=new Date(now.getTime()+opt.expires);cfg.expires=cfg.expires.toGMTString();}
var keys=['path','domain','secure'];for(i=0;i<keys.length;i++)
if(opt[keys[i]])
cfg[keys[i]]=opt[keys[i]];var r=cookify(key,val,cfg);doc.cookie=r;return val;},has:function(key){key=esc(key);var c=doc.cookie,ofs=c.indexOf(key+'='),len=ofs+key.length+1,sub=c.substring(0,key.length);return((!ofs&&key!=sub)||ofs<0)?false:true;},get:function(key){key=esc(key);var c=doc.cookie,ofs=c.indexOf(key+'='),len=ofs+key.length+1,sub=c.substring(0,key.length),end;if((!ofs&&key!=sub)||ofs<0)
return null;end=c.indexOf(';',len);if(end<0)
end=c.length;return un(c.substring(len,end));},remove:function(k){var r=me.get(k),opt={expires:EPOCH};doc.cookie=cookify(k,'',opt);return r;},keys:function(){var c=doc.cookie,ps=c.split('; '),i,p,r=[];for(i=0;i<ps.length;i++){p=ps[i].split('=');r.push(un(p[0]));}
return r;},all:function(){var c=doc.cookie,ps=c.split('; '),i,p,r=[];for(i=0;i<ps.length;i++){p=ps[i].split('=');r.push([un(p[0]),un(p[1])]);}
return r;},version:'0.2.1',enabled:false};me.enabled=alive.call(me);return me;}());empty=function(){};esc=function(str){return'PS'+str.replace(/_/g,'__').replace(/ /g,'_s');};C={search_order:['gears','localstorage','whatwg_db','globalstorage','flash','ie','cookie'],name_re:/^[a-z][a-z0-9_ -]+$/i,methods:['init','get','set','remove','load','save'],sql:{version:'1',create:"CREATE TABLE IF NOT EXISTS persist_data (k TEXT UNIQUE NOT NULL PRIMARY KEY, v TEXT NOT NULL)",get:"SELECT v FROM persist_data WHERE k = ?",set:"INSERT INTO persist_data(k, v) VALUES (?, ?)",remove:"DELETE FROM persist_data WHERE k = ?"},flash:{div_id:'_persist_flash_wrap',id:'_persist_flash',path:'persist.swf',size:{w:1,h:1},args:{autostart:true}}};B={gears:{size:-1,test:function(){return(window.google&&window.google.gears)?true:false;},methods:{transaction:function(fn){var db=this.db;db.execute('BEGIN').close();fn.call(this,db);db.execute('COMMIT').close();},init:function(){var db;db=this.db=google.gears.factory.create('beta.database');db.open(esc(this.name));db.execute(C.sql.create).close();},get:function(key,fn,scope){var r,sql=C.sql.get;if(!fn)
return;this.transaction(function(t){r=t.execute(sql,[key]);if(r.isValidRow())
fn.call(scope||this,true,r.field(0));else
fn.call(scope||this,false,null);r.close();});},set:function(key,val,fn,scope){var rm_sql=C.sql.remove,sql=C.sql.set,r;this.transaction(function(t){t.execute(rm_sql,[key]).close();t.execute(sql,[key,val]).close();if(fn)
fn.call(scope||this,true,val);});},remove:function(key,fn,scope){var get_sql=C.sql.get;sql=C.sql.remove,r,val;this.transaction(function(t){if(fn){r=t.execute(get_sql,[key]);if(r.isValidRow()){val=r.field(0);t.execute(sql,[key]).close();fn.call(scope||this,true,val);}else{fn.call(scope||this,false,null);}
r.close();}else{t.execute(sql,[key]).close();}});}}},whatwg_db:{size:200*1024,test:function(){var name='PersistJS Test',desc='Persistent database test.';if(!window.openDatabase)
return false;if(!window.openDatabase(name,C.sql.version,desc,B.whatwg_db.size))
return false;return true;},methods:{transaction:function(fn){if(!this.db_created){var sql=C.sql.create;this.db.transaction(function(t){t.executeSql(sql,[],function(){this.db_created=true;});},empty);}
this.db.transaction(fn);},init:function(){var desc,size;desc=this.o.about||"Persistent storage for "+this.name;size=this.o.size||B.whatwg_db.size;this.db=openDatabase(this.name,C.sql.version,desc,size);},get:function(key,fn,scope){var sql=C.sql.get;if(!fn)
return;scope=scope||this;this.transaction(function(t){t.executeSql(sql,[key],function(t,r){if(r.rows.length>0)
fn.call(scope,true,r.rows.item(0)['v']);else
fn.call(scope,false,null);});});},set:function(key,val,fn,scope){var rm_sql=C.sql.remove,sql=C.sql.set;this.transaction(function(t){t.executeSql(rm_sql,[key],function(){t.executeSql(sql,[key,val],function(t,r){if(fn)
fn.call(scope||this,true,val);});});});return val;},remove:function(key,fn,scope){var get_sql=C.sql.get;sql=C.sql.remove;this.transaction(function(t){if(fn){t.executeSql(get_sql,[key],function(t,r){if(r.rows.length>0){var val=r.rows.item(0)['v'];t.executeSql(sql,[key],function(t,r){fn.call(scope||this,true,val);});}else{fn.call(scope||this,false,null);}});}else{t.executeSql(sql,[key]);}});}}},globalstorage:{size:5*1024*1024,test:function(){return window.globalStorage?true:false;},methods:{key:function(key){return esc(this.name)+esc(key);},init:function(){this.store=globalStorage[this.o.domain];},get:function(key,fn,scope){key=this.key(key);if(fn)
fn.call(scope||this,true,this.store.getItem(key));},set:function(key,val,fn,scope){key=this.key(key);this.store.setItem(key,val);if(fn)
fn.call(scope||this,true,val);},remove:function(key,fn,scope){var val;key=this.key(key);val=this.store[key];this.store.removeItem(key);if(fn)
fn.call(scope||this,(val!==null),val);}}},localstorage:{size:-1,test:function(){return window.localStorage?true:false;},methods:{key:function(key){return esc(this.name)+esc(key);},init:function(){this.store=localStorage;},get:function(key,fn,scope){key=this.key(key);if(fn)
fn.call(scope||this,true,this.store.getItem(key));},set:function(key,val,fn,scope){key=this.key(key);this.store.setItem(key,val);if(fn)
fn.call(scope||this,true,val);},remove:function(key,fn,scope){var val;key=this.key(key);val=this.getItem(key);this.store.removeItem(key);if(fn)
fn.call(scope||this,(val!==null),val);}}},ie:{prefix:'_persist_data-',size:64*1024,test:function(){return window.ActiveXObject?true:false;},make_userdata:function(id){var el=document.createElement('div');el.id=id;el.style.display='none';el.addBehavior('#default#userData');document.body.appendChild(el);return el;},methods:{init:function(){var id=B.ie.prefix+esc(this.name);this.el=B.ie.make_userdata(id);if(this.o.defer)
this.load();},get:function(key,fn,scope){var val;key=esc(key);if(!this.o.defer)
this.load();val=this.el.getAttribute(key);if(fn)
fn.call(scope||this,val?true:false,val);},set:function(key,val,fn,scope){key=esc(key);this.el.setAttribute(key,val);if(!this.o.defer)
this.save();if(fn)
fn.call(scope||this,true,val);},load:function(){this.el.load(esc(this.name));},save:function(){this.el.save(esc(this.name));}}},cookie:{delim:':',size:4000,test:function(){return P.Cookie.enabled?true:false;},methods:{key:function(key){return this.name+B.cookie.delim+key;},get:function(key,val,fn,scope){key=this.key(key);val=ec.get(key);if(fn)
fn.call(scope||this,val!=null,val);},set:function(key,val,fn,scope){key=this.key(key);ec.set(key,val,this.o);if(fn)
fn.call(scope||this,true,val);},remove:function(key,val,fn,scope){var val;key=this.key(key);val=ec.remove(key)
if(fn)
fn.call(scope||this,val!=null,val);}}},flash:{test:function(){if(!window.SWFObject||!deconcept||!deconcept.SWFObjectUtil)
return false;var major=deconcept.SWFObjectUtil.getPlayerVersion().major;return(major>=8)?true:false;},methods:{init:function(){if(!B.flash.el){var o,key,el,cfg=C.flash;el=document.createElement('div');el.id=cfg.div_id;document.body.appendChild(el);o=new SWFObject(this.o.swf_path||cfg.path,cfg.id,cfg.size.w,cfg.size.h,'8');for(key in cfg.args)
o.addVariable(key,cfg.args[key]);o.write(el);B.flash.el=document.getElementById(cfg.id);}
this.el=B.flash.el;},get:function(key,fn,scope){var val;key=esc(key);val=this.el.get(this.name,key);if(fn)
fn.call(scope||this,val!==null,val);},set:function(key,val,fn,scope){var old_val;key=esc(key);old_val=this.el.set(this.name,key,val);if(fn)
fn.call(scope||this,true,val);},remove:function(key,fn,scope){var val;key=esc(key);val=this.el.remove(this.name,key);if(fn)
fn.call(scope||this,true,val);}}}};var init=function(){var i,l,b,key,fns=C.methods,keys=C.search_order;for(i=0,l=fns.length;i<l;i++)
P.Store.prototype[fns[i]]=empty;P.type=null;P.size=-1;for(i=0,l=keys.length;!P.type&&i<l;i++){b=B[keys[i]];if(b.test()){P.type=keys[i];P.size=b.size;for(key in b.methods)
P.Store.prototype[key]=b.methods[key];}}
P._init=true;};P={VERSION:VERSION,type:null,size:0,add:function(o){B[o.id]=o;C.search_order=[o.id].concat(C.search_order);init();},remove:function(id){var ofs=C.search_order.indexOf(id);if(ofs<0)
return;C.search_order.splice(ofs,1);delete B[id];init();},Cookie:ec,Store:function(name,o){if(!C.name_re.exec(name))
throw new Error("Invalid name");if(!P.type)
throw new Error("No suitable storage found");o=o||{};this.name=name;o.domain=o.domain||location.hostname||'localhost.localdomain';this.o=o;o.expires=o.expires||365*2;o.path=o.path||'/';this.init();}};init();return P;})();
// PROJECT BLACKBOX
(function(dxm){
	
	// PUBSUB INTERNALS
	// Publishers announce when an event of note has occured
	// Subscribers react when they get the announcement of the change
	
	// Pubsub System Closure
	dxm = {};
	dxm.notification = dxm.notification || {};
	
	// System Settings
	dxm.settings = {};
	dxm.settings.consoleLog = false;

	// List of Subscribers
	dxm.notification.subscribers = [];
	dxm.notification.log = [];
	
	/* SUBSCRIBE */
	dxm.notification.subscribe = function (notification, subscriber, response, responseParams) {
		
		// if the list of subscribers for this notification doesn't exist, create it
		if (!dxm.notification.subscribers[notification]) {
			dxm.notification.subscribers[notification] = {};
		}
		
		// get list of subscribers to this notification
		var subscriberList = dxm.notification.subscribers[notification];
		
		// add subscriber to the list with function of what they do in response, with params if needed
		subscriberList[subscriber] = {}
		subscriberList[subscriber].response = response;
		subscriberList[subscriber].responseParams = responseParams || null;
		
		// update log
		dxm.notification.log.push({"type": "subscribe", "notification": notification, "subscriber": subscriber});
		
		
	}
	
	/* UNSUBSCRIBE */
	dxm.notification.unsubscribe = function (notification, subscriber) {
		
		// if the subscription list DNE or subscriber isn't on the list, exit
		if (!dxm.notification.subscribers[notification] || !dxm.notification.subscribers[notification][subscriber]) {
			return;
		}
		
		// unsubscribe
		delete dxm.notification.subscribers[notification][subscriber];
		
		// update log
		dxm.notification.log.push({"type": "unsubscribe", "notification": notification, "unsubscriber": subscriber});		
		
	}
	
	/* PUBLISH */
	dxm.notification.publish = function (notification, notificationParams, publisher) {
		
		// if there are no subscribers, exit
		if (!dxm.notification.subscribers[notification]) {
			return;
		}

		publisher = publisher || "unidentified";
		
		// required vars
		var subscriberList = dxm.notification.subscribers[notification],
			informedSubscribers = [];

		
		for (var subscriber in subscriberList) {
			
			
			var params = {};
			params.notificationParams = notificationParams || null;
			params.responseParams = dxm.notification.subscribers[notification][subscriber].responseParams || null;
			
			// inform subscriber in a separate thread 
			setTimeout( (function(subscriber, params) { 
				return function() {
					subscriberList[subscriber].response(params);
				} 
			})(subscriber, params), 0 );
			
			// keep track of who has been informed
			informedSubscribers.push(subscriber); 
			
		}
		
		// update log 
		dxm.notification.log.push({"type": "publish", "notification": notification, "informedSubscribers": informedSubscribers, "publisher": publisher});

		if(dxm.settings.consoleLog !== false){

			console.log('\n Published: ' + notification + '\n Publisher: ' + publisher +  '\n Informed: ' + JSON.stringify(informedSubscribers) );
			console.log("----------------------\n");
		}		
	}

	window.dxmPubSub = dxm.notification;
	window.dxmPubSub.consoleLogOn = function(){ dxm.settings.consoleLog = true; };
	window.dxmPubSub.consoleLogOff = function(){ dxm.settings.consoleLog = false; };
	
})();
(function(){

    // container
    var app = {},

        intervals = {},

        network = Offline,

        pubsub = dxmPubSub,
        _publish = pubsub.publish,
        _subscribe = pubsub.subscribe,
        _subscribe_once = subscribe_once,
        _unsubscribe = pubsub.unsubscribe,
        
        allScreens = document.getElementsByClassName('fullscreen'),
        screen_setup = {},

        activeScreenIndex = 0,
        activeScreens = [],

        addProductName,
        addProductManufacturer,

        deviceStorage;

    // screen setup bindings
        screen_setup.landing = setup_landing;
        screen_setup.view_product_list = setup_view_product_list;
        screen_setup.add_product_metadata = setup_add_product_metadata;
        screen_setup.add_product_confirmation = setup_add_product_confirmation;

    // internal functions

        /* INIT */
            
            // get the app started
                function init(){

                    // req vars
                    var current_network_state = networkState();

                    // Load Starting Pages
                        resetActiveScreens();
                        
                    // Set Screen Heights
                        setFullscreenHeight();

                    // Prepare for Window Size Changes
                        setResizeResponses();
                        setResizeListener();

                    // Prepare for Network Changes
                        setNetworkChangeResponses();
                        setNetworkListeners();

                    // Set Appcache Listeners
                        setAppcacheListeners();

                    // Create Network Transaction Offline Storage Area
                        setDeviceStorage();

                    // Set Current Network State
                        if( current_network_state === "up"){          

                            _publish("network-up", null, this);
                        } 
                        else {          

                            _publish("network-down", null, this);           
                        }

                    // Prepare Screen Setup Listeners
                        screenSetupHandlers();

                        gotoScreen( activeScreenIndex );

                    // Disable Touch Scrolling
                        document.addEventListener('touchmove', function(e){

                            var swipe_target = e.target;

                            while(swipe_target !== document.body){
                                
                                swipe_target = swipe_target.parentNode;
                            }

                            e.preventDefault();
                        });
                }

        /* SCREENS */

            // landing
                function setup_landing(screen){

                    // req vars
                        var startBtn = screen.getElementsByClassName('btn')[0];
                    
                    /* SETUP */

                        // listen for teardown event
                            _subscribe_once('teardown-screen', 'landing', teardown);
                        
                        // bind enter key 
                            window.addEventListener('keydown', enterHandler);

                        // bind button
                            startBtn.addEventListener('click', gotoNextScreen);


                    function teardown(){

                        // unbind enter key
                            window.removeEventListener('keydown', enterHandler);

                        //unbind button
                            startBtn.removeEventListener('click', gotoNextScreen);
                    }

                    function enterHandler(e){

                        if(e.keyCode === 13){
                            
                            gotoNextScreen();
                        }
                    }
                }

            // add product metadata
                function setup_add_product_metadata(screen){

                    /* SETUP */

                        // required vars
                            var currentScreenInputs = screen.getElementsByTagName('input'),
                                productNameInput = screen.getElementsByClassName('product-name')[0],
                                manufacturerNameInput = screen.getElementsByClassName('manufacturer-name')[0],
                                manufacturerList = screen.getElementsByClassName('manufacturer-list')[0],
                                nextBtn = screen.getElementsByClassName('btn')[0];

                        //  activate next btn
                            nextBtn.addEventListener("click", nextBtnHandler);

                        // enter button handler
                            window.addEventListener("keydown", enterBtnHandler);
                    
                        // prep for teardown
                            _subscribe_once('teardown-screen', 'add-product-metadata', teardown);
                            
                        // reset task global vars
                            _subscribe_once('task-ended', 'reset-new-product-values', function(){

                                addProductName = null;
                                addProductManufacturer = null;
                            });

                        // push manufacturer list value to manufacturer name input
                            manufacturerList.addEventListener("change", update_manufacturer_name_field);

                        // populate manufacturer list
                            render_manufacturer_list();


                    function teardown(){

                        // required vars
                            var totalInputs = currentScreenInputs.length;

                            for (var i = totalInputs - 1; i >= 0; i--) {
                                
                                // reset value
                                    currentScreenInputs[i].value = "";

                                // clear fields with attention
                                    if( hasClass(currentScreenInputs[i], "attention") ){

                                        removeClass(currentScreenInputs[i], "attention");
                                    }
                            }

                            if ( hasClass(manufacturerList, "attention") ){

                                removeClass(manufacturerList, "attention");
                            }

                        // clean up listeners
                            nextBtn.removeEventListener("click", nextBtnHandler);                            
                            window.removeEventListener("keydown", enterBtnHandler);
                            manufacturerNameInput.removeEventListener("change", update_manufacturer_name_field);
                    }

                    function render_manufacturer_list(){

                        // required vars
                            var manufacturer_db_json,
                                manufacturer_db;

                        // load
                            deviceStorage.get("manufacturer", function(ok, value){

                                if(ok && value !== null){

                                    manufacturer_db_json = value;
                                    do_list_rendering(manufacturer_db_json);
                                }

                                _subscribe_once(

                                    "manufacturer-metadata-updated",
                                    "render-manufacturer-list",
                                    render_newest_db
                                );
                                
                                download_current_manufacturer_db();

                                function render_newest_db(data){

                                    if(manufacturer_db_json == data.notificationParams){ return; }
                                    
                                    manufacturer_db_json = data.notificationParams;
                                    do_list_rendering(manufacturer_db_json);
                                }
                            });

                            function do_list_rendering(manufacturer_db_json){

                                var manufacturer_json = manufacturer_db_json,
                                    markup = "<option value='0'>-- Select Manufacturer --</option>";

                                manufacturer_db = JSON.parse(manufacturer_db_json);

                                manufacturer_db.sort(function(a, b){

                                    a = a.Name.toLowerCase();
                                    b = b.Name.toLowerCase();

                                    if(a > b){ return 1; }
                                    else if(b > a){ return -1; }
                                    else { return 0; }
                                });

                                for(var manufacturer in manufacturer_db){

                                    markup += "<option value='" + manufacturer_db[manufacturer].Id + "'>" + manufacturer_db[manufacturer].Name.toUpperCase() + "</option>"; 
                                }

                                markup += "<option value='-1'>-- New Manufacturer --</option>";

                                manufacturerList.innerHTML = markup;
                            }
                    }

                    function update_manufacturer_name_field(){

                        var option = manufacturerList.options[manufacturerList.selectedIndex],
                            option_value = option.value,
                            option_text = option.text;

                        // add new manufacturer
                            if(option_value === "-1"){

                                // view manufacturer name field
                                    manufacturerNameInput.value = "";

                                    if(manufacturerNameInput.type != "text"){
                                        manufacturerNameInput.type = "text";
                                    }

                                    manufacturerNameInput.focus();

                                // reset view state on screen teardown
                                    _subscribe_once('teardown-screen', 'hide-manufacturer-textfield', function(){
                                    
                                        manufacturerNameInput.type = "hidden";
                                    });

                                return;
                            }

                        // hide default input field
                            if(manufacturerNameInput.type != "hidden"){

                                manufacturerNameInput.type = "hidden";
                            }

                        // blank option - do nothing
                            if(option_value === "0"){ return; }

                        // default - set hidden manufacturer field                         
                            manufacturerNameInput.value = option_text;
                    }

                    function nextBtnHandler(){

                        // required vars
                            var missingInput = 0,
                                totalInputs = currentScreenInputs.length;

                        // mark empty fields
                            for (var i = totalInputs - 1; i >= 0; i--){

                                if( currentScreenInputs[i].value ){ continue; }

                                if( currentScreenInputs[i] == manufacturerNameInput && manufacturerNameInput.getAttribute('type') == "hidden"){

                                    addClass( manufacturerList, "attention");
                                    manufacturerList.addEventListener("change", manufacturerSelected);                                    
                                } 
                                
                                missingInput += 1;

                                addClass( currentScreenInputs[i], "attention");

                                currentScreenInputs[i].addEventListener("keyup", confirmValueExists);
                            }

                        // proceed if nothing is missing
                            if(missingInput < 1){

                                addProductName = productNameInput.value;
                                addProductManufacturer = manufacturerNameInput.value;
                                gotoNextScreen();
                            }
                    }

                    function enterBtnHandler(e){

                        if(e.keyCode != 13){ return; }

                        nextBtnHandler();
                    }

                    function confirmValueExists(e){

                        if(!e.target.value){ return; }

                        removeClass(e.target, "attention");
                        e.target.removeEventListener("keydown", confirmValueExists);
                    }

                    function manufacturerSelected(){

                        if(!manufacturerNameInput.value){ return; }

                        removeClass(manufacturerList, "attention");
                        manufacturerList.addEventListener("keyup", manufacturerSelected);
                    }
                }

            // add product confirmation
                function setup_add_product_confirmation(screen){

                    // required variables
                    var manufacturer_name_slots = screen.getElementsByClassName('manufacturer-name'),
                        product_name_slots = screen.getElementsByClassName('product-name'),
                        create_product_btn = document.getElementById('submit-add-product');

                    // populate manufacturer name slots
                        for (var i = manufacturer_name_slots.length - 1; i >= 0; i--) {
                            
                            manufacturer_name_slots[i].innerHTML = addProductManufacturer;
                        }

                    // populate product name slots
                        for (i = product_name_slots.length - 1; i >= 0; i--) {
                            
                            product_name_slots[i].innerHTML = addProductName;
                        }

                    // Activate Submit Button
                        create_product_btn.addEventListener("click", add_product_to_db);

                        _subscribe_once("teardown-screen", "add-product-confirmation", function(){

                            // disable finalize button
                                create_product_btn.removeEventListener("click", add_product_to_db);

                            // wipe manufacturer name slots
                                for (var i = manufacturer_name_slots.length - 1; i >= 0; i--) {
                                    
                                    manufacturer_name_slots[i].innerHTML = "";
                                }

                            // wipe product name slots
                                for (i = product_name_slots.length - 1; i >= 0; i--) {
                                    
                                    product_name_slots[i].innerHTML = "";
                                } 
                        });

                    function add_product_to_db(){

                        // required vars
                        var product_metadata = {},
                            restart_task;
                            
                            product_metadata.name = encodeURIComponent( addProductName );
                            product_metadata.manufacturer = encodeURIComponent( addProductManufacturer );

                        // send to server
                            HTTP_POST("add-product.php", "product=" + JSON.stringify(product_metadata) );

                        // restart task dialog
                            restart_task = confirm("Done! Add Another Product?");                            
                        
                            if(restart_task === true){

                                _unsubscribe('task-ended', 'task-teardown');                                        
                           
                                _subscribe_once(
                                    "task-ended",
                                    "restart-task",
                                    function(){                                        

                                        removeActiveScreens('add-product');
                                        addProductsWorkflow();
                                    }     
                                );
                            }                        

                        // complete task
                            _publish('task-ended', null, 'add-product-btn');
                    }
                }

            // view product list
                function setup_view_product_list(screen){

                    // required vars
                    var product_list_wrapper = document.getElementById('product-list'),
                        manufacturer_list_wrapper = document.getElementById('manufacturer-list'),
                        product_list_touchstart_pos;


                    // teardown
                        _subscribe_once("teardown-screen", "teardown", teardown);

                    // update product list view when model updates
                        _subscribe("product-metadata-updated", "update-product-list", function(data){

                            alert("Loading Updates");

                            render_product_list();
                        });

                    // update manufacturer list view when model updates
                        _subscribe("manufacturer-metadata-updated", "update-manufacturer-list", function(data){

                            render_manufacturer_list();
                        });

                    // filter rendered product list by manufacturer
                        _subscribe("product-list-rendered", "filter-by-manufacturer", function(){

                                if ("createEvent" in document) {
                                    var evt = document.createEvent("HTMLEvents");
                                    evt.initEvent("change", false, true);
                                    manufacturer_list_wrapper.dispatchEvent(evt);
                                }
                                
                                else {
                                    manufacturer_list_wrapper.fireEvent("onchange");
                                }
                            }
                        );

                    // fit list wrapper to screen size and update on resize
                        resize_list_wrappers();
                        _subscribe("screens-resized", "resize-list-wrappers", resize_list_wrappers);
                    
                    // activate edit button on product list  
                        product_list_wrapper.addEventListener("click", edit_product);

                    // activate touch scrolling 
                        product_list_wrapper.addEventListener("touchstart", set_scroll_touch_position);
                        product_list_wrapper.addEventListener("touchmove", product_list_wrapper_scroll);

                    // activate filtering by manufacturer
                        manufacturer_list_wrapper.addEventListener("change", manufacturer_filter);

                    // render modules
                        render_product_list();
                        render_manufacturer_list();
                        create_add_product_btn();


                    function teardown(){

                        product_list_wrapper.removeEventListener("click", edit_product);
                        product_list_wrapper.removeEventListener("touchmove", product_list_wrapper_scroll);

                        _unsubscribe("screens-resized", "resize-list-wrapper");

                        _unsubscribe("product-list-rendered", "filter-by-manufacturer");

                        _unsubscribe("product-metadata-updated", "update-product-list");
                        
                        _subscribe_once("setup-complete", "cleanup-product-list", function(){
                            
                            setTimeout(function(){
                                
                                product_list_wrapper.innerHTML = "";
                                

                                manufacturer_list_wrapper.selectedIndex = 0;

                                if ("createEvent" in document) {
                                    var evt = document.createEvent("HTMLEvents");
                                    evt.initEvent("change", false, true);
                                    manufacturer_list_wrapper.dispatchEvent(evt);
                                }
                                
                                else {
                                    manufacturer_list_wrapper.fireEvent("onchange");
                                }

                                manufacturer_list_wrapper.removeEventListener("change", manufacturer_filter);
                            }, 150);
                        });
                    }

                    function product_list_wrapper_scroll(e){

                        var click_target = e.target,
                            product_list_touch_pos = e.changedTouches[0].clientY;


                        // filter events that arent from the product list
                            while( click_target != product_list_wrapper ){

                                if( click_target.parentNode == screen || click_target.parentNode == document.body ){ return; }
                                click_target = click_target.parentNode;
                            }

                        // prevent product list scroll from bubbling to body where all touchmove events go to die
                            if( (click_target.scrollTop < (click_target.scrollHeight - click_target.clientHeight) && product_list_touch_pos - product_list_touchstart_pos < 0) || (click_target.scrollTop > 0 && product_list_touch_pos - product_list_touchstart_pos > 0 )){ 
                                
                                e.stopPropagation(); 
                            }
                    }

                    function set_scroll_touch_position(e){

                        product_list_touchstart_pos = e.changedTouches[0].clientY;
                    }

                    function resize_list_wrappers(){

                        resize_product_list_wrapper();
                    }

                    function resize_product_list_wrapper(){

                        product_list_wrapper.style.height = (screen.offsetHeight * 0.7) + "px";
                    }

                    function resize_manufacturer_list_wrapper(){

                        manufacturer_list_wrapper.style.height = (screen.offsetHeight * 0.2) + "px";
                    }

                    function render_manufacturer_list(){

                        var markup = "<option value='-1'>ALL</option>",
                            manufacturer_db_json,
                            manufacturer_db;

                        // load
                            deviceStorage.get("manufacturer", function(ok, value){

                                if(ok && value !== null){

                                    manufacturer_db_json = value;
                                    do_list_rendering();
                                }

                                else {

                                    _subscribe_once(

                                        "manufacturer-metadata-updated",
                                        "render-product-list",
                                        function(data){

                                            manufacturer_db_json = data.notificationParams;
                                            do_list_rendering();
                                        }
                                    );
                                }
                                
                                download_current_manufacturer_db();
                            });

                            function do_list_rendering(){

                                manufacturer_db = JSON.parse(manufacturer_db_json);

                                manufacturer_db.sort(function(a, b){

                                    a = a.Name.toLowerCase();
                                    b = b.Name.toLowerCase();

                                    if(a > b){ return 1; }
                                    else if(b > a){ return -1; }
                                    else { return 0; }
                                });

                                for(var manufacturer in manufacturer_db){

                                    markup += "<option value='" + manufacturer_db[manufacturer].Id + "'>" + manufacturer_db[manufacturer].Name.toUpperCase() + "</option>"; 
                                }

                                manufacturer_list_wrapper.innerHTML = markup;
                            }
                    }

                    function render_product_list(){

                        var markup = "",

                            product_db_json,
                            transaction_db_json,
                            manufacturer_db_json;

                        // load required db data
                            deviceStorage.get("product", function(ok, value){

                                if(ok && value !== null){

                                    product_db_json = value;

                                    if(all_dbs_loaded()){

                                        do_list_rendering();
                                    }
                                }

                                else {

                                    _subscribe_once(

                                        "product-metadata-updated",
                                        "render-product-list",
                                        function(data){

                                            product_db_json = data.notificationParams;

                                            if(all_dbs_loaded()){

                                                do_list_rendering();
                                            }
                                        }
                                    );
                                }

                                download_current_product_db();
                            });

                            deviceStorage.get("manufacturer", function(ok, value){

                                if(ok && value !== null){

                                    manufacturer_db_json = value;

                                    if(all_dbs_loaded()){

                                        do_list_rendering();
                                    }
                                }

                                else {

                                    _subscribe_once(

                                        "manufacturer-metadata-updated",
                                        "render-product-list",
                                        function(data){

                                            manufacturer_db_json = data.notificationParams;

                                            if(all_dbs_loaded()){

                                                do_list_rendering();
                                            }
                                        }
                                    );
                                }

                                download_current_manufacturer_db();
                            });

                            deviceStorage.get("transaction", function(ok, value){

                                if(ok && value !== null){

                                    transaction_db_json = value;

                                    if(all_dbs_loaded()){

                                        do_list_rendering();
                                    }
                                }

                                else {

                                   transaction_db_json = "[]";

                                    if(all_dbs_loaded()){

                                        do_list_rendering();
                                    }                                   
                                }
                            });

                        function do_list_rendering(){

                            var product_db,
                                manufacturer_db,
                                transaction_db,

                                product_db_length;

                                product_db = JSON.parse(product_db_json);
                                product_db_length = product_db.length;

                                if(!product_db || product_db.length < 1){

                                    markup = "there are no products in the database ...";
                                    product_list_wrapper.innerHTML = markup;
                                }

                                else {

                                    manufacturer_db = key_model_db_json(manufacturer_db_json, "Id");
                                    transaction_db = JSON.parse(transaction_db_json);

                                    if(!transaction_db.product){ transaction_db.product = {}; }

                                    product_db.sort(function(a, b){

                                        a = a.Name.toLowerCase();
                                        b = b.Name.toLowerCase();

                                        if(a > b){ return 1; }
                                        else if(b > a){ return -1; }
                                        else { return 0; }
                                    });

                                // render product view
                                    for (var i = product_db.length; i >= 1; i--) {

                                        var product = product_db[ product_db_length - i ],
                                            product_id = product.Id,

                                            manufacturer_id = product.ManufacturerId,

                                            has_updates,
                                            has_retail_price_update,
                                            has_wholesale_price_update,
                                            
                                            retail_price,
                                            wholesale_price;

                                        has_updates = transaction_db.product && transaction_db.product[ product_id ] ? true : false;
                                        
                                        has_retail_price_update = has_updates && transaction_db.product[ product_id ].RetailPrice ? true : false;
                                        retail_price = has_retail_price_update ? "&#8358;" + transaction_db.product[ product_id ].RetailPrice : ( product.RetailPrice ? "&#8358;" + product.RetailPrice : "-----");
                                        
                                        has_wholesale_price_update = has_updates && transaction_db.product[ product_id ].WholesalePrice ? true : false;
                                        wholesale_price = has_wholesale_price_update ? "&#8358;" + transaction_db.product[ product_id ].WholesalePrice : ( product.WholesalePrice ? "&#8358;" + product.WholesalePrice : "-----");
                                        
                                        markup += "<div class='product" + (has_updates ? " editted-product" : "") + "' data-product-name='" + product.Name + "' data-product-id='" + product_id + "'data-manufacturer-id='" + manufacturer_id + "'> <div class='name'><span class='collapsed-content'>" + manufacturer_db[ manufacturer_id ].Name + "</span> " + product.Name + "</div> <div class='wholesale-price" + (has_wholesale_price_update ? " modified-value" : "") + "'>" + wholesale_price  + "</div>" + "<div class='retail-price" + (has_retail_price_update ? " modified-value" : "") + "'>" + retail_price  + "</div>" + "<div class='settings'><span>edit</span></div></div>";
                                    }                                    
                                    
                                    product_list_wrapper.innerHTML = markup;
                                }

                                _publish("product-list-rendered", null, "render-product-list");
                        }

                        function all_dbs_loaded(){

                            var load_status = false;

                            if(
                                typeof product_db_json != "undefined" &&
                                typeof transaction_db_json != "undefined" &&
                                typeof manufacturer_db_json != "undefined"
                            ){

                                load_status = true;
                            }

                            return load_status;
                        }
                    }                        

                    function edit_product(e){

                        var edit_btn = e.target,
                            
                            click_target,
                            click_target_id,

                            edit_options_markup,
                            edit_options,
                            edit_wholesale_price_btn,
                            edit_retail_price_btn,
                            
                            set_price_prompt;

                        // filter events that arent from the edit btn
                            while( !hasClass(edit_btn, "settings") ){

                                if( edit_btn.parentNode == product_list_wrapper || edit_btn.parentNode == document.body ){ return; }
                                
                                edit_btn = edit_btn.parentNode;
                            }

                        // identify the product
                            click_target = edit_btn.parentNode;

                        // if options menu is already open ... bail
                            if(edit_btn.getElementsByClassName('options').length > 0){

                                return;
                            }

                            addClass(click_target, "edit-product");

                            click_target_id = click_target.getAttribute('data-product-id');

                        // display edit options
                            edit_options_markup = "<ul class='options'><li class='edit-wholesale-price'>wholesale price</li><li class='edit-retail-price'>retail price</li></ul>";
                            edit_btn.innerHTML += edit_options_markup;

                        // get dom nodes of options
                            edit_options = edit_btn.getElementsByClassName('options')[0];
                            edit_wholesale_price_btn = edit_options.getElementsByClassName('edit-wholesale-price')[0];
                            edit_retail_price_btn = edit_options.getElementsByClassName('edit-retail-price')[0];

                        // activate edit options
                            edit_retail_price_btn.addEventListener('click', set_retail_price);
                            edit_wholesale_price_btn.addEventListener('click', set_wholesale_price);

                        // add options removal on next click to event stack
                            setTimeout(function(){

                                screen.addEventListener('click', remove_edit_options_menu);                                
                            }, 0);


                        function remove_edit_options_menu(){

                            // remove edit options
                                edit_options.parentNode.removeChild(edit_options);

                            // remove visual identifier
                                removeClass(click_target, "edit-product");

                            // cleanup option remover
                                screen.removeEventListener('click', remove_edit_options_menu);
                        }

                        function set_retail_price(e){
                            
                            // required vars
                                var product_price = click_target.getElementsByClassName('retail-price')[0];

                            // get new price 
                                set_price_prompt = prompt(click_target.getAttribute('data-product-name').toUpperCase() + " - Retail Price", product_price.innerHTML.replace(/\D/g,""));

                                if(set_price_prompt !== null){


                                    update_product_retail_price(click_target_id, set_price_prompt);

                                    product_price.innerHTML = "&#8358;" + set_price_prompt;
                                    
                                    addClass(product_price, "modified-value");
                                    addClass(click_target, "editted-product");
                                }
                        }

                        function set_wholesale_price(e){

                            // required vars
                                var product_price = click_target.getElementsByClassName('wholesale-price')[0];
                            
                            // get new price 
                                set_price_prompt = prompt( click_target.getAttribute('data-product-name').toUpperCase() + " - Wholesale Price", product_price.innerHTML.replace(/\D/g, ""));

                                if(set_price_prompt !== null){


                                    update_product_wholesale_price(click_target_id, set_price_prompt);

                                    product_price.innerHTML = "&#8358;" + set_price_prompt;
                                    
                                    addClass(product_price, "modified-value");
                                    addClass(click_target, "editted-product");
                                }
                        }
                    }

                    function manufacturer_filter(e){

                        var dropdown = e.target,
                            dropdown_selection = dropdown.options[dropdown.selectedIndex],
                            selected_manufacturer_id = dropdown_selection.value,
                            product_list = product_list_wrapper.getElementsByClassName('product');

                            if(selected_manufacturer_id == -1){

                                removeClass(product_list_wrapper, "filtered");
                            }

                            else{

                                addClass(product_list_wrapper, "filtered");
                            } 

                            for(var id in product_list){

                                var product = product_list[id];

                                if(typeof product.parentNode == "undefined"){ continue; }

                                if(product.getAttribute('data-manufacturer-id') == selected_manufacturer_id){

                                    addClass(product, 'manufacturer-filter-match');
                                }

                                else {
                                    
                                    removeClass(product, 'manufacturer-filter-match');
                                }
                            }                        
                    }

                    function update_product_wholesale_price(product_id, price){

                        deviceStorage.get("transaction", function(ok, value){

                            // required vars
                                var transactions_json = '{}';

                            // get prexisting transactions
                                if(value){ 

                                    transactions_json = value;                                    
                                }

                            // add product update to next transaction
                                transaction_db = JSON.parse(transactions_json);

                                if(!transaction_db.product){ transaction_db.product = {}; }

                                if(!transaction_db.product[product_id]){ transaction_db.product[product_id] = {}; }
                                
                                transaction_db.product[product_id].WholesalePrice = encodeURIComponent( price );

                                deviceStorage.set('transaction', JSON.stringify(transaction_db));
                        });
                    }

                    function update_product_retail_price(product_id, price){

                        deviceStorage.get("transaction", function(ok, value){

                            // required vars
                                var transactions_json = '{}';

                            // get prexisting transactions
                                if(value){ 

                                    transactions_json = value;                                    
                                }

                            // add product update to next transaction
                                transaction_db = JSON.parse(transactions_json);

                                if(!transaction_db.product){ transaction_db.product = {}; }

                                if(!transaction_db.product[product_id]){ transaction_db.product[product_id] = {}; }
                                
                                transaction_db.product[product_id].RetailPrice = encodeURIComponent( price );

                                deviceStorage.set('transaction', JSON.stringify(transaction_db));
                        });
                    }
                }

        /* SCREEN UTILS */

            // screen setup handler
                function screenSetupHandlers(){

                    _subscribe("setup-screen", "do_screen_setup", do_screen_setup );                    
                }

            // set up window resize listener
                function setResizeListener(){

                    onResize(function(){

                        _publish('window-resized', null, this);
                    });
                }

            // set resize responses
                function setResizeResponses(){
                    
                    // when window is resized, resize screens
                        _subscribe( 'window-resized', 'screen-height-updater', setFullscreenHeight );

                    // when screens are resized, scroll to the active one
                        _subscribe( 'screens-resized', 'autoscroller', scrollToActiveScreen );
                }

            // set active screens heights
                function setFullscreenHeight(){

                    var padding_top,
                        padding_bottom;

                    for (var i = activeScreens.length - 1; i >= 0; i--) {

                        if (i < activeScreenIndex) { break; }

                        padding_top = document.defaultView.getComputedStyle(activeScreens[i],null).getPropertyValue('padding-top').replace("px", "");
                        padding_bottom = document.defaultView.getComputedStyle(activeScreens[i],null).getPropertyValue('padding-bottom').replace("px", "");
                        
                        activeScreens[i].style.height = (window.innerHeight - padding_top - padding_bottom ) + "px";
                    }

                    _publish('screens-resized', null, this);
                }

            // quickly scroll to active screen
                function scrollToActiveScreen(){

                    scrollTo( activeScreens[activeScreenIndex].offsetTop, 150 ); 
                }

            // do screen setup
                function do_screen_setup(){

                    // req vars
                    var thisScreen = activeScreens[ activeScreenIndex ],
                        thisScreenSetupID = thisScreen.id.replace(/\-/g,"_");

                    // scroll to screen when setup is complete
                        _subscribe_once(
                            'setup-complete', 
                            'scroll-screen-into-view', 
                            function(){ 
                                
                                scrollTo( thisScreen.offsetTop, 400);
                            }
                        );

                    // focal screen tracker
                        addClass( thisScreen, "focal" );
                        
                        _subscribe_once(

                            'teardown-screen',
                            'defocalizer',
                            function(){

                                removeClass(thisScreen, 'focal');
                            }
                        );

                    // set up this screen
                        screen_setup[ thisScreenSetupID ](thisScreen);

                    // setup complete!
                        _publish('setup-complete', null, 'do_screen_setup');
                }

            // deactivate screen and go to a new one
                function gotoScreen(index){

                    _publish("teardown-screen", null, this);

                    activeScreenIndex = index;

                    _publish("setup-screen", null, this );
                }

                    function gotoNextScreen(){

                        gotoScreen(activeScreenIndex + 1);
                    }

            // add active screens
                function addToActiveScreens( screenClass ){

                    var new_screens_tally = 0;

                    for (var i = 0; i < allScreens.length; i++) {
                        
                        if ( hasClass(allScreens[i], screenClass) ) { 

                            // add active class
                                addClass(allScreens[i], 'active');

                            // add to active screens list
                                activeScreens.push( allScreens[i] );

                            // count new screens added
                                new_screens_tally = new_screens_tally + 1;
                        } 
                    }

                    if (new_screens_tally > 0){

                        setFullscreenHeight();
                    }
                }

            // remove active screens
                function removeActiveScreens( screenClass ){

                    var change_tally = 0;

                    for (var i = activeScreens.length - 1; i >= 0; i--){
                        
                        if( hasClass(activeScreens[i], screenClass) ){

                            // remove active class
                                removeClass(activeScreens[i], 'active');

                            // remove from active screens list
                                activeScreens.splice(i, 1);

                            // update tally
                                change_tally = change_tally + 1;
                        }

                        if (change_tally > 0){

                            setFullscreenHeight();
                            activeScreenIndex = activeScreens.length - 1;
                        }
                    }
                }

            // reset active screens
                function resetActiveScreens(){

                    for (var i = 0; i < allScreens.length; i++) {
                        
                        // remove active class
                            removeClass(allScreens[i], 'active');                     
                    }

                    activeScreens = [];
                    addToActiveScreens('landing');
                    addToActiveScreens('view-product');
                } 

        /* NETWORK */

            // configure network detection
                network.options = {

                    checkOnLoad: true,
                    interceptRequests: false,
                    requests: false,
                    checks: {active: 'xhr', xhr: {url: 'server-check.php'}}
                };

            // heartbeat
                function heartbeat(){ 

                    // req vars
                    var stopHeartbeat = function(){

                        clearInterval( intervals.heartbeat );
                        delete intervals.heartbeat;
                    };

                    // check every 7.5s
                        intervals.heartbeat = setInterval( network.check, 1000 * 7.5);

                    // stop heartbeat on disconnect from the internet
                        _subscribe_once(
                            "network-down",
                            "heartbeat",
                            stopHeartbeat,
                            null
                        );
                }

            // send transaction to server
                function doTransaction(){ 

                    // req vars
                    var stopTransactions = function(){

                        clearInterval( intervals.transaction );
                        delete intervals.transaction;
                    };

                    // check every 30 secs
                        intervals.transaction = setInterval( function(){

                            deviceStorage.get('transaction', function(ok, value){

                                var transactions = JSON.parse(value),
                                    has_transactions = false;

                                if(!transactions){ return }

                                for(var data in transactions){ if(transactions.hasOwnProperty(data)){ has_transactions = true; break; } }

                                if(!has_transactions){ return }

                                HTTP_POST(

                                    "process-transaction.php",
                                    "transaction=" + value,
                                    function(){

                                        var transaction_json = value,
                                            resend_prompt; 

                                        return function(response_json){

                                            var response;

                                            try {

                                                response = JSON.parse(response_json);
                                            } 

                                            catch(e){

                                                console.log("TRANSACTION ERROR");
                                                console.log(response_json);

                                                resend_prompt = confirm("RESEND THESE UPDATES? " + transaction_json);

                                                if(resend_prompt){

                                                    // iterate over object here
                                                    console.log("do resend here");
                                                    console.log(transaction_json);
                                                }

                                                return false;
                                            }

                                            download_current_product_db();

                                            console.log("-- TRANSACTION REPORT --");

                                            // product updates in the transaction
                                                if(response.product){

                                                    deviceStorage.get('product', function(ok, value){

                                                        var product_db = JSON.parse(value);
                                                        
                                                        for(var id in response.product){

                                                            var product_name;

                                                            for (var i = product_db.length - 1; i >= 0; i--) {
                                                                
                                                                if(product_db[product_db.length - 1 - i].Id == id){

                                                                    product_name = product_db[product_db.length - 1 - i].Name;
                                                                    break;
                                                                }
                                                            }                                                   

                                                            for(var property in response.product[id]){

                                                                console.log(product_name.toUpperCase() + " " + property.toUpperCase() + " UPDATED TO '" + response.product[id][property] + "'");
                                                            }
                                                        }
                                                    });
                                                }
                                        };
                                    }()
                                );

                                deviceStorage.set('transaction', "{}");
                            });

                        }, 1000 * 60 * 0.5);

                    // stop transaction on disconnect from the internet
                        _subscribe_once(
                            "network-down",
                            "transaction",
                            stopTransactions,
                            null
                        );
                }

            // update product db
                function download_current_product_db(){

                    download_to_local_db('product', 'get-product.php');
                }

            // update manufacturer db
                function download_current_manufacturer_db(){

                    download_to_local_db('manufacturer', 'get-manufacturer.php');
                }

            // download updates to db on device
                function download_to_local_db(db_name, url){

                    if(!db_name || !url){

                        return false;
                    }

                    deviceStorage.get(db_name, function(ok, value){
                        
                        // get product db via ajax
                            HTTP_POST(
                                url, 
                                null,
                                function(response){

                                    // filter unchanged list
                                        if(value == response) { return; }
                                        
                                    // update the pricelist
                                        deviceStorage.set(db_name, response);
                                    
                                    _publish(db_name + "-metadata-updated", response, "download-current-" + db_name + "-db");
                                }
                            );
                    });
                }

            // flicker network connection lights
                function flickerNetworkLights(){

                    var indicators = document.getElementsByClassName('connection-indicator');
                    
                    // Flicker Lights while Reconnecting  
                        intervals.checkingLightFlickerInterval = setInterval( function(){             

                            for (var i = indicators.length - 1; i >= 0; i--) {
                                
                                // Orange On
                                    addClass(indicators[i], "connection-checking");

                                // Orange Off
                                    setTimeout( function(){

                                        var count = i;

                                        return function(){ removeClass(indicators[count], "connection-checking"); };
                                    }(), 350);
                            }
                        }, 2000);

                    // Stop Flickering on Reconnect Exit
                        _subscribe_once(

                            'network-reconnecting-exit', 
                            'light-flicker',
                            function(){

                                clearInterval( intervals.checkingLightFlickerInterval );
                            },
                            null
                        );
                }

            // set network online class
                function setOnlineBodyClass(){
                   
                   removeClass(document.body, "connection-offline");
                   addClass(document.body, "connection-online");
                }

            // set network offline class
                function setOfflineBodyClass(){
                    
                    removeClass(document.body, "connection-online");
                    addClass(document.body, "connection-offline");
                }

            // get current network state
                function networkState(){

                    network.check();

                    return network.state;
                }

            // set up network state listeners
                function setNetworkListeners(){

                    // connected to network
                        network.on("up", function(){

                            _publish("network-up", null, "connection-watchdog");
                        });

                    // disconnected from network
                        network.on("down", function(){

                            _publish("network-down", null, "connection-watchdog");
                        });

                    // started to reconnect
                        network.on("reconnect:started", function(){

                            _publish("network-reconnecting", null, "connection-watchdog");
                        });

                    // stopped reconnect
                        network.on("reconnect:stopped", function(){

                            _publish("network-reconnecting-exit", null, "connection-watchdog");
                        });
                }

            // set network state change responses
                function setNetworkChangeResponses(){

                    // Online -> Set Body Class
                        _subscribe( 'network-up', 'online-indicator', setOnlineBodyClass );

                    // Online -> Continuously Check Network State
                        _subscribe( 'network-up', 'heartbeat', heartbeat );

                    // Online -> Process Pending Transactions
                        _subscribe( 'network-up', 'transaction', doTransaction );

                    // Offline -> Set Body Class
                        _subscribe( 'network-down', 'online-indicator', setOfflineBodyClass );

                    // Reconnect -> Flicker Lights
                        _subscribe( 'network-reconnecting', 'light-flicker', flickerNetworkLights );
                } 

        /* APPCACHE */

            // set appcache listeners
                function setAppcacheListeners(){

                    if (window.applicationCache){

                        window.applicationCache.addEventListener('downloading', cacheDownloading);
                        window.applicationCache.addEventListener('updateready', cacheReady);
                    }
                }

            // new appcache ready
                function cacheReady(){     

                    alert('App Has Been Updated and will Restart Now');
                    window.applicationCache.swapCache();
                    location.reload(true);
                }

            // new appcache downloading
                function cacheDownloading(){

                    alert("Downloading App Updates - Sorry for the Wait");
                }

        /* OFFLINE STORAGE */

            function setDeviceStorage(){

                createDeviceStorage();
            }

            function createDeviceStorage(){

                deviceStorage = new Persist.Store('Pricing App Storage', {

                    about: "Data Storage to enhance Offline usage",
                    path: location.href
                });
            }


        /* UTILS */

            // subscribe once
                function subscribe_once(notification, subscriber, response, responseParams){

                    _subscribe(
                        notification, 
                        subscriber,

                        function(data){

                            response(data);
                            _unsubscribe(notification,subscriber);
                        },

                        responseParams
                    );
                }

            // scroll to 
               var scrollTo = (function(){

                    var timer, start, factor;

                    return function (target, duration, callback) {
                        
                        var offset = window.pageYOffset,
                            delta  = target - window.pageYOffset; // Y-offset difference
                            duration = duration || 400;              // default 400ms animation
                            callback = callback || function(){ _publish("arrived-at-new-screen", null, "scroll-screen-into-view"); };
                            start = Date.now();                       // get start time
                            factor = 0;

                        if( timer ) {
                            clearInterval(timer); // stop any running animations
                        }

                        function step() {
                            
                            var y;
                            factor = (Date.now() - start) / duration; // get interpolation factor

                            if( factor >= 1 ) {
                                clearInterval(timer); // stop animation
                                factor = 1;           // clip to max 1.0

                                callback();
                            } 

                            y = factor * delta + offset;

                            window.scrollBy(0, y - window.pageYOffset);
                        }

                        timer = setInterval(step, 10);
                        
                        return timer;
                    };
                }());

            // window resize detection + debouncer
                function onResize(c,t){
                    
                    onresize = function(){
                        
                        clearTimeout(t);
                        t=setTimeout(c,250);
                    };

                    return c;
                }

            // check if class exists
                function hasClass(element, nameOfClass){

                    return element.className.match(new RegExp('(\\s|^)'+nameOfClass+'(\\s|$)'));
                }

            // add class if it doesn't exist
                function addClass(element, nameOfClass){
                
                    if ( !hasClass(element, nameOfClass) ){
                        
                        element.className += " "+nameOfClass;
                    }
                }

            // remove class if it exists
                function removeClass(element, nameOfClass){
                
                    if ( hasClass(element, nameOfClass) ){
                        
                        var reg = new RegExp('(\\s|^)'+nameOfClass+'(\\s|$)');
                        element.className=element.className.replace(reg,' ');
                    }
                }

            // XMLHTTP POST
                function HTTP_POST(url, msg, success, fail){

                    // filter
                        if (!url){ return false; }

                    // reqs
                    var server_trip = new XMLHttpRequest();
                        
                        msg = msg || "";
                        success = success || function(response){ console.log("POST TO " + url + " SUCCESSFUL! \nRESPONSE: "); console.log(response); };
                        fail = fail || function(response){ console.log("POST TO " + url + " UNSUCCESSFUL. \nXMLHTTP OBJECT:"); console.log(response); };

                    // prep POST
                        server_trip.open('POST', url, true);
                        server_trip.setRequestHeader("Content-type","application/x-www-form-urlencoded");
                        server_trip.onreadystatechange = function(){

                            // filter uncompleted responses
                                if (server_trip.readyState !=4){ return; }

                            // success
                                if ( server_trip.status > 199 && server_trip.status < 400 ){ success(server_trip.responseText); }

                            // fail
                                else{ fail(server_trip); }                      
                        };

                    // POST
                        server_trip.send(msg);

                    return true;    
                }

            // model json by key
                function key_model_db_json( db_json, key ){

                    var db,
                        modelled_db = {};

                    db = JSON.parse( db_json );

                    for(var row in db){

                        modelled_db[ db[row][key] ] = db[row];
                    }

                    return modelled_db;
                }

            // model db by collection
                function collection_model_db_json( db_json, key ){

                    var db,
                        modelled_db = {};

                    db = JSON.parse( db_json );

                    for(var row in db){

                        if( !modelled_db[ db[row][key] ] ){  modelled_db[ db[row][key] ] = {}; }
                        
                        modelled_db[ row[key] ].push( db[row] );
                    }

                    return modelled_db;
                }

            // context settings - cancel task
                function create_cancel_task_btn(){

                    var contextSettingsMenu = document.getElementById('context-settings'),
                        cancelTaskBtnMarkup = "<div id='cancel-task' class='setting'>cancel task</div>";

                    // create Cancel Task button                            
                        contextSettingsMenu.innerHTML += cancelTaskBtnMarkup;

                    // remove btn when task ends
                        _subscribe_once("task-ended", "remove-cancel-task-btn", 

                            function(){

                                var cancel_task_btn = document.getElementById('cancel-task');

                                cancel_task_btn.parentNode.removeChild(cancel_task_btn);
                            }
                        );

                    // set behavior
                        document.getElementById('cancel-task').addEventListener("click", function(){

                            _publish("task-ended", "cancel-task-btn");
                        });
                }            

            // context settings - add product
                function create_add_product_btn(){

                    var contextSettingsMenu = document.getElementById('context-settings'),
                        addProductBtnMarkup = "<div id='start-add-product' class='setting'>+ add product</div>";

                    // create add product button                            
                        contextSettingsMenu.innerHTML += addProductBtnMarkup;

                    // remove btn when task ends
                        _subscribe_once("teardown-screen", "remove-add-product-btn", 

                            function(){

                                var add_product_btn = document.getElementById('start-add-product');

                                add_product_btn.parentNode.removeChild(add_product_btn);
                            }
                        );

                    // set behavior
                        document.getElementById('start-add-product').addEventListener("click", addProductsWorkflow);
                }            
            
            function addProductsWorkflow(){

                // activate add product screens 
                    addToActiveScreens('add-product');
                
                // progress UI
                    gotoNextScreen();

                // add cancel task btn to HUD
                    create_cancel_task_btn();

                // clean up task when it ends
                    _subscribe_once('task-ended', 'task-teardown', function(){

                        gotoScreen(1);
                        setTimeout(function(){
                            removeActiveScreens('add-product');
                        }, 250);
                    });
            }

            function viewProductsWorkflow(){

                // activate add product screens 
                    addToActiveScreens('view-product');
                
                // progress UI
                    gotoNextScreen();

                // add cancel task btn to HUD
                    create_cancel_task_btn();

                // clean up task when it ends
                    _subscribe_once('task-ended', 'task-teardown', function(){

                        gotoScreen(1);
                        setTimeout(function(){
                            removeActiveScreens('view-product');
                        }, 250);
                    });
            }

            pubsub.log.crawl = function(key){

                var results = "";

                for(var i = 0; i < pubsub.log.length - 1; i += 1){ 

                if( 
                    (
                        (typeof key == 'string' || key instanceof String) && (   
                            ((typeof pubsub.log[i].publisher == 'string' || pubsub.log[i].publisher instanceof String) && pubsub.log[i].publisher.toLowerCase() == key.toLowerCase()) ||  ((typeof pubsub.log[i].subscriber == 'string' || pubsub.log[i].subscriber instanceof String) && pubsub.log[i].subscriber.toLowerCase() == key.toLowerCase()) ||  ((typeof pubsub.log[i].unsubscriber == 'string' || pubsub.log[i].unsubscriber instanceof String) && pubsub.log[i].unsubscriber.toLowerCase() == key.toLowerCase()) ||  ((typeof pubsub.log[i].type == 'string' || pubsub.log[i].type instanceof String)  && pubsub.log[i].type.toLowerCase() == key.toLowerCase()) ||  ((typeof pubsub.log[i].notification == 'string' || pubsub.log[i].notification instanceof String) && pubsub.log[i].notification.toLowerCase() == key.toLowerCase()) 
                        )
                    ) || (key === null && pubsub.log[i].publisher) 
                ){ 

                    results += "\n\n-[" + i + "]-\n[" +  ( pubsub.log[i].subscriber || pubsub.log[i].publisher || pubsub.log[i].unsubscriber ) + "] " + pubsub.log[i].type + " " + pubsub.log[i].notification;
                }
                }

                console.log(results);
            };

            pubsub.log.range = function(a,b){

                var results = "",
                    start,
                    end;

                start = a > b ? b : a;
                end = a > b ? a : b;


                if(start < 0 || end > pubsub.log.length - 1){

                    return console.log("wtf bro");
                }

                console.log("crawling " + start + " to " + end);

                for(var i = start; i <= end; i += 1){

                    results += "\n\n-[" + i + "]-\n[" +  ( pubsub.log[i].subscriber || pubsub.log[i].publisher || pubsub.log[i].unsubscriber ) + "] " + pubsub.log[i].type + " " + pubsub.log[i].notification;
                }

                console.log(results);
            };

    // LAUNCH APP WHEN DOM IS READY
        document.addEventListener("DOMContentLoaded", function(){ 

            init();
            goto = gotoScreen;
            ASE = activeScreens;
            currentIntervals = intervals;
            peepDB = function(db_name){

                deviceStorage.get(db_name, function(ok, value){

                    if(!ok){ console.log("couldn't retrieve " + db_name + " db"); return; }

                    console.log( JSON.parse(value) );
                });
            };
        });
}());</script>
	</body>
</html>